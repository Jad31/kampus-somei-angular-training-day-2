<div class="missions-container">
  <div class="missions-header">
    <h1>Gestion des Missions</h1>
    <button class="btn-primary" (click)="toggleNewMissionForm()">
      {{ showNewMissionForm ? 'Annuler' : 'Nouvelle Mission' }}
    </button>
  </div>

  @if (showNewMissionForm) {
    <div class="new-mission-form">
      <h2>Nouvelle Mission</h2>
      <!-- TODO: Implement the reactive form here -->
      <div class="form-placeholder">
        <p>À implémenter : Formulaire réactif pour ajouter une nouvelle mission</p>
        <p>Le formulaire devra inclure :</p>
        <ul>
          <li>Nom de la mission</li>
          <li>Priorité (low, medium, high)</li>
          <li>Date de début</li>
          <li>Description (optionnelle)</li>
        </ul>
      </div>
    </div>
  }

  <h2>Missions de la Station</h2>

  @defer (on viewport) {
    <div class="mission-stats">
      <div class="stat-item">
        <span class="stat-label">Total des missions:</span>
        <span class="stat-value">{{ missionStats.totalMissions }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Missions actives:</span>
        <span class="stat-value">{{ missionStats.activeMissions }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Dernière mise à jour:</span>
        <span class="stat-value">{{ missionStats.lastUpdate | date:'medium' }}</span>
      </div>
    </div>
  } @placeholder (minimum 500ms) {
    <div class="mission-stats loading">
      <div class="stat-item">
        <span class="stat-label">Chargement des statistiques...</span>
      </div>
    </div>
  } @loading (after 1000ms; minimum 1s) {
    <div class="mission-stats loading">
      <div class="stat-item">
        <div class="loading-spinner"></div>
        <span class="stat-label">Chargement en cours...</span>
      </div>
    </div>
  }

  @defer (on idle) {
    <div class="mission-timeline">
      <h3>Timeline des Missions</h3>
      <div class="timeline-content">
        <!-- Timeline content here -->
      </div>
    </div>
  } @placeholder {
    <div class="mission-timeline loading">
      <h3>Timeline des Missions</h3>
      <p>La timeline sera chargée lorsque le navigateur sera inactif</p>
    </div>
  } @loading {
    <div class="mission-timeline loading">
      <div class="loading-spinner"></div>
      <p>Chargement de la timeline...</p>
    </div>
  }

  <div class="missions-grid">
    @for (mission of missions; track mission.id) {
      <div class="mission-card">
        <h3>{{ mission.name }}</h3>

        <div class="description">
          Planification et suivi des expériences scientifiques
        </div>

        @switch (mission.status) {
          @case ('pending') {
            <span class="status-badge pending">En attente</span>
          }
          @case ('in-progress') {
            <span class="status-badge in-progress">En cours</span>
          }
          @case ('completed') {
            <span class="status-badge completed">Terminée</span>
          }
          @case ('failed') {
            <span class="status-badge failed">Échec</span>
          }
        }

        @defer (on hover) {
          <div class="mission-details">
            <p>
              <strong>Priorité:</strong>
              <span [class]="'priority-indicator ' + getPriorityClass(mission.priority)">
                {{ mission.priority }}
              </span>
            </p>
            <p>
              <strong>Date de début:</strong>
              <span>{{ mission.startDate | date }}</span>
            </p>
            @if (mission.endDate) {
              <p>
                <strong>Date de fin:</strong>
                <span>{{ mission.endDate | date }}</span>
              </p>
            }
          </div>
        } @placeholder {
          <div class="mission-details loading">
            <p>Survolez pour voir les détails</p>
          </div>
        } @loading {
          <div class="mission-details loading">
            <div class="loading-spinner"></div>
            <p>Chargement des détails...</p>
          </div>
        }

        @defer (on interaction) {
          <div class="mission-actions">
            <button class="action-button start" (click)="startMission(mission)">Démarrer</button>
            <button class="action-button pause" (click)="pauseMission(mission)">Pause</button>
            <button class="action-button complete" (click)="completeMission(mission)">Terminer</button>
          </div>
        } @placeholder {
          <div class="mission-actions loading">
            <p>Cliquez pour voir les actions disponibles</p>
          </div>
        } @loading {
          <div class="mission-actions loading">
            <div class="loading-spinner"></div>
            <p>Chargement des actions...</p>
          </div>
        }

        <a href="#" class="explorer-button">Explorer</a>
      </div>
    } @empty {
      <p class="no-missions">Aucune mission en cours</p>
    }
  </div>

  @defer (on timer(2000)) {
    <div class="mission-analytics">
      <h3>Analytics</h3>
      <div class="analytics-content">
        <div class="analytics-card">
          <h4>Taux de réussite</h4>
          <div class="analytics-value">{{ getSuccessRate() }}%</div>
          <div class="analytics-label">Missions complétées avec succès</div>
        </div>
        <div class="analytics-card">
          <h4>Temps moyen</h4>
          <div class="analytics-value">{{ getAverageDuration() }}j</div>
          <div class="analytics-label">Durée moyenne des missions</div>
        </div>
        <div class="analytics-card">
          <h4>Priorités</h4>
          <div class="analytics-value">{{ getPriorityDistribution().high }}</div>
          <div class="analytics-label">Missions de haute priorité</div>
        </div>
        <div class="analytics-card">
          <h4>Efficacité</h4>
          <div class="analytics-value">{{ getEfficiencyRate() }}%</div>
          <div class="analytics-label">Taux d'efficacité globale</div>
        </div>
      </div>
    </div>
  } @placeholder {
    <div class="mission-analytics loading">
      <h3>Analytics</h3>
      <p>Les analytics seront chargés dans 2 secondes</p>
    </div>
  } @loading {
    <div class="mission-analytics loading">
      <div class="loading-spinner"></div>
      <p>Chargement des analytics...</p>
    </div>
  }

  @defer (on viewport) {
    <div class="mission-history">
      <h3>Historique des Missions</h3>
      <div class="history-content">
        <div class="history-timeline">
          @for (mission of missions; track mission.id) {
            <div class="history-item">
              <div class="history-date">{{ mission.startDate | date:'mediumDate' }}</div>
              <div class="history-details">
                <h4>{{ mission.name }}</h4>
                <p class="history-status" [class]="'status-' + mission.status">
                  {{ mission.status | titlecase }}
                </p>
                @if (mission.endDate) {
                  <p class="history-duration">
                    Durée: {{ getMissionDuration(mission) }} jours
                  </p>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  } @placeholder(minimum 500ms) {
    <div class="mission-history loading">
      <h3>Historique des Missions</h3>
      <p>L'historique sera chargé lorsque vous ferez défiler jusqu'à cette section</p>
    </div>
  } @loading (after 100ms; minimum 1s) {
    <div class="mission-history loading">
      <div class="loading-spinner"></div>
      <p>Chargement de l'historique...</p>
    </div>
  }
</div>
